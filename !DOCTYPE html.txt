<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今彩 539 機率與賠率計算機</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        :root {
            --primary-color: #3b82f6;
            --secondary-color: #f1f5f9;
            --text-color: #334155;
            --bg-color: #ffffff;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background: var(--bg-color);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 700;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .input-group select,
        .input-group input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: #fff;
        }

        .input-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='w-6 h-6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='m19.5 8.25-7.5 7.5-7.5-7.5' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em;
        }

        #calculate-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #calculate-btn:hover {
            background-color: #2563eb;
        }

        #result-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: var(--secondary-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: opacity 0.5s ease;
            opacity: 0;
            visibility: hidden;
        }

        #result-container.show {
            opacity: 1;
            visibility: visible;
        }

        #result-container h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        .result-item {
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
        }

        .result-item strong {
            color: var(--primary-color);
        }

        .hint {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>今彩 539 機率與賠率計算機</h1>
        
        <div class="input-group">
            <label for="selectedNumbers">您選擇的號碼個數：</label>
            <input type="number" id="selectedNumbers" min="1" max="5" value="3">
            <div class="hint">從 1 到 5 個號碼中選擇</div>
        </div>

        <div class="input-group">
            <label for="correctNumbers">您猜中的號碼個數：</label>
            <select id="correctNumbers">
                <option value="0">0 個</option>
                <option value="1">1 個</option>
                <option value="2">2 個</option>
                <option value="3" selected>3 個</option>
            </select>
            <div class="hint">猜中號碼數不能超過您選擇的號碼數</div>
        </div>

        <button id="calculate-btn">計算機率與賠率</button>

        <div id="result-container">
            <h2>計算結果</h2>
            <div class="result-item">機率：<strong id="probability-result"></strong></div>
            <div class="result-item">賠率：<strong id="odds-result"></strong></div>
            <div class="result-item">約等於 <strong id="approximate-result"></strong> 次會中獎一次</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const selectedNumbersInput = document.getElementById('selectedNumbers');
            const correctNumbersSelect = document.getElementById('correctNumbers');
            const calculateBtn = document.getElementById('calculate-btn');
            const resultContainer = document.getElementById('result-container');
            const probabilityResult = document.getElementById('probability-result');
            const oddsResult = document.getElementById('odds-result');
            const approximateResult = document.getElementById('approximate-result');

            // 計算階乘的函式
            function factorial(n) {
                if (n < 0) return 0;
                if (n === 0) return 1;
                let result = 1;
                for (let i = 2; i <= n; i++) {
                    result *= i;
                }
                return result;
            }

            // 計算組合數 C(n, k) 的函式
            function combinations(n, k) {
                if (k < 0 || k > n) {
                    return 0;
                }
                if (k === 0 || k === n) {
                    return 1;
                }
                if (k > n / 2) {
                    k = n - k;
                }
                return factorial(n) / (factorial(k) * factorial(n - k));
            }

            // 更新猜中號碼下拉式選單的選項
            const updateCorrectNumbersOptions = (maxCount) => {
                correctNumbersSelect.innerHTML = '';
                for (let i = 0; i <= maxCount; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `${i} 個`;
                    correctNumbersSelect.appendChild(option);
                }
            };

            // 監聽選擇號碼數量的變動，動態更新猜中號碼的選項
            selectedNumbersInput.addEventListener('input', (event) => {
                let value = parseInt(event.target.value, 10);
                if (isNaN(value) || value < 1) {
                    value = 1;
                }
                if (value > 5) {
                    value = 5;
                }
                selectedNumbersInput.value = value;
                updateCorrectNumbersOptions(value);
            });

            // 初始化時設定選項
            updateCorrectNumbersOptions(parseInt(selectedNumbersInput.value, 10));

            // 計算機率的主函式
            const calculate = () => {
                const myNumbersCount = parseInt(selectedNumbersInput.value, 10);
                const correctNumbersCount = parseInt(correctNumbersSelect.value, 10);

                if (isNaN(myNumbersCount) || isNaN(correctNumbersCount) || myNumbersCount < 1 || myNumbersCount > 5) {
                    alert('請輸入有效的號碼個數 (1-5)。');
                    return;
                }

                // 總開獎號碼數
                const totalNumbers = 39;
                // 開獎號碼數
                const winningNumbers = 5;

                // 分母：所有可能的開獎組合
                const totalCombinations = combinations(totalNumbers, winningNumbers);

                // 分子：猜中指定數量的號碼組合
                const correctCombinations = combinations(winningNumbers, correctNumbersCount);
                const incorrectCombinations = combinations(totalNumbers - winningNumbers, myNumbersCount - correctNumbersCount);
                const favorableCombinations = correctCombinations * incorrectCombinations;

                // 計算機率
                const probability = favorableCombinations / totalCombinations;

                // 顯示結果
                if (favorableCombinations === 0) {
                    probabilityResult.textContent = '機率為 0';
                    oddsResult.textContent = '無限大';
                    approximateResult.textContent = '不可能發生';
                } else {
                    probabilityResult.textContent = (probability * 100).toFixed(6) + '%';
                    const odds = 1 / probability;
                    oddsResult.textContent = `1 : ${odds.toFixed(2)}`;
                    approximateResult.textContent = `${Math.floor(odds)}`
                }
                resultContainer.classList.add('show');
            };

            calculateBtn.addEventListener('click', calculate);
        });
    </script>
</body>
</html>